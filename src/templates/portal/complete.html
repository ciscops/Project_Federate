{% extends 'base.html' %}

{% block content %}
<div class="row dbl-margin-bottom">
	<div class="col-12">
		<div class="panel panel--raised" style="background-color: #f2f2f2; text-align:center;">
			<form method="post">
				<div class="row">
					<div class="col-2"></div>
					<div class="col-8">
						<h1>{% block title %}<u>Services</u>{% endblock %}</h1>
					</div>
					<div class="col-2"></div>
				</div>
				<div class="row base-margin-bottom">
					<div class="col-2"></div>
					<div class="col-8">
						<div class="responsive-table">
							<table class="table">
								<thead>
								<tr>
									<th></th>
									<th></th>
								</tr>
								</thead>
								<tbody>
								<tr>
									<td><h5>DNA-Center:</h5></td>
									<td>
										{% if dnac_status == True %}
										<button class="btn btn--circle btn--success btn--large">
											<span class="icon-check"></span>
										</button>
										{% else %}
										<button class="btn btn--circle btn--danger btn--large">
											<span class="icon-exit"></span>
											{% endif %}
									</td>
									<td><h5>Prime:</h5></td>
									<td>
										{% if prime_status == True %}
										<button class="btn btn--circle btn--success btn--large">
											<span class="icon-check"></span>
										</button>
										{% else %}
										<button class="btn btn--circle btn--danger btn--large">
											<span class="icon-exit"></span>
											{% endif %}
									</td>
								</tr>
								<tr>
									<td><h5>BMC Remedy:</h5></td>
									<td>
										{% if bmc_status == True %}
										<button class="btn btn--circle btn--success btn--large">
											<span class="icon-check"></span>
										</button>
										{% else %}
										<button class="btn btn--circle btn--danger btn--large">
											<span class="icon-exit"></span>
											{% endif %}
									</td>
									<td><h5>MKSFT Teams:</h5></td>
									<td>
										{% if mksft_teams_status == True %}
										<button class="btn btn--circle btn--success btn--large">
											<span class="icon-check"></span>
										</button>
										{% else %}
										<button class="btn btn--circle btn--danger btn--large">
											<span class="icon-exit"></span>
											{% endif %}
									</td>
								</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="row">
	<div class="col-12">
		<div class="panel panel--raised" style="background-color: #f2f2f2; text-align:center;">
			<div class="row">
				<div class="col-2"></div>
				<div class="col-8">
					<h1><u>Event Logs</u></h1>
				</div>
				<div class="col-2"></div>
			</div>
			<div class="row base-margin-bottom">
				<div class="col-2"></div>
				<div class="col-4">
					<h5><u>DNA-Center</u></h5>
					<script>
							seen_events = {}
							first_through = true;
							function updateDNACEvents(){
								console.log("Pulling in new events")
								const http = new XMLHttpRequest();
								const url = '{{url_for("portal.events")}}';
								http.open("GET", url);
								http.send();
								http.onreadystatechange = (e) => {
									dnac_events = document.getElementById("dnacevents");
									prime_alarms = document.getElementById("primealarms");
									try{
										new_events = JSON.parse(http.responseText);
									}
									catch(err) {
										dnac_events.innerHTML = "<li>There was an error</li>";
										prime_alarms.innerHTML = "<li>There was an error</li>";
										return;
									}
									if (first_through) {
										dnac_events.innerHTML = "";
										prime_alarms.innerHTML = "";
										first_through = false;
									}
									for(event of new_events)
									{
										if (!(event.id in seen_events))
										{
											seen_events[event.id] = event;
											evt_html = "<li>" + event.name + ": " + event.description + "</li><br>";
											if (event.type == "dnac") dnac_events.innerHTML += evt_html;
											if (event.type == "prime") prime_alarms.innerHTML += evt_html;
										}
									}
								}
							}
							setTimeout(updateDNACEvents, 0);
							setInterval(updateDNACEvents, 1000 * 60 * 2);
						</script>
					<ul id="dnacevents" style="list-style-type:none">
						<li>Loading</li>
						<br>
					</ul>
				</div>
				<div class="col-4">
					<h5><u>Prime Infrastructure</u></h5>
            <ul id="primealarms" style="list-style-type:none">
              <li>Loading</li>
				<br>
            </ul>
          </div>
					<div class="col-2"></div>
				</div>
			</div>
		</div>
	</div>

{% endblock %}